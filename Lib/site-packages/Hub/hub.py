





import os
LAUNCH_PATH = os.getcwd()

with open(r'C:\\Launch', 'w') as f:
    f.write(LAUNCH_PATH)
from Hub.functions import *
########################################################################################### FIRST ABOVE NEED
from paths import *
from PyQt5.QtWidgets import QApplication, QWidget
from PyQt5.QtGui import QIcon
from PyQt5.QtWidgets import QApplication, QWidget, QInputDialog, QLineEdit, QFileDialog
from PyQt5.QtWidgets import QApplication, QWidget, QPushButton, QMessageBox
from PyQt5 import QtGui, uic, Qt
from PyQt5.QtGui import QStandardItemModel,QStandardItem
from paths import *
from PyQt5.QtGui import QIcon, QPixmap
from PyQt5.QtGui import *
from PyQt5.QtWidgets import *
from PyQt5.QtCore import *
from paths import *
import PyQt5
from PyQt5 import QtCore
import subprocess
import time
import os
from Wizard.wizard import Wizard_Class
import shutil, errno
import ctypes
import time
import threading
from shutil import copyfile
from distutils.dir_util import copy_tree

MaximumWidth = 95 * 2
MinimumWidth = 95 * 2
MaximumHeight = 30
MinimumHeight = 30



try:
    from pywinauto.application import Application
    app = Application().connect(title=u'C:\\WINDOWS\\system32\\cmd.exe', class_name='ConsoleWindowClass')
    consolewindowclass = app.ConsoleWindowClass
    consolewindowclass.close()
except Exception as e:
    print(e)





class QPushButton_Custom_Class(QPushButton):
    def __init__(self,text,path):
        super().__init__()
        textt = text.capitalize().replace('.exe','')
        if textt == 'Ecp':
            textt = "Elan Connect Pro"
        if textt == 'Win_scp':
            textt = "Win SCP"
        if textt == 'Angry_ip_scanner':
            textt = "Angry IP Scanner"



        self.setText(textt)
        self.path = path
        self.setMaximumWidth(MaximumWidth)
        self.setMinimumWidth(MinimumWidth)
        self.setMaximumHeight(MaximumHeight)
        self.setMinimumHeight(MinimumHeight)

    def Was_Clicked(self):
        try:
            os.startfile(self.path)
        except Exception as e:
            print(e)


class Hub_Class(QWidget):
    def __init__(self):
        super().__init__()
        self.ui = uic.loadUi(Hub_Ui)

        self.ui.label_4.setText(os.listdir(Controler_Build_Location)[0])



        self.ui.setWindowIcon(QtGui.QIcon(loading_eyepng))
        #self.ui.showMaximized()
        self.ui.resize(400, 600)
        self.ui.show()
        LAUNCH_PATH = os.getcwd()
        #self.ui.label_4.setText(LAUNCH_PATH)
        self.ui.actionReset_Sytem_And_Project.triggered.connect(self.Reset_Sytem_And_Project)
        self.ui.actionReset_Sytem.triggered.connect(self.Reset_Sytem)
        self.ui.actionReset_Project.triggered.connect(self.Reset_Project)
        icon = QtGui.QPixmap(Hub_Icon_For_Tools)
        self.ui.pushButton_8.setIcon(QtGui.QIcon(icon))

        self.ui.actionSave_System_And_Project.triggered.connect(self.Save_Sytem_And_Project)
        self.ui.actionSave_System.triggered.connect(self.Save_Sytem)
        self.ui.actionSave_Project.triggered.connect(self.Save_Project)

        self.ui.actionConfiguration.triggered.connect(self.Configuration_Menu)

        self.init_Tools()
        self.ui.pushButton_9.clicked.connect(self.update_controller_build)
        self.ui.pushButton_3.clicked.connect(self.script_writer_clicked)
        self.ui.pushButton_4.clicked.connect(self.script_runner_was_clicked)
        self.ui.pushButton_7.clicked.connect(self.delete_project)
        self.ui.pushButton_6.clicked.connect(self.clone_project)
        self.ui.pushButton_5.clicked.connect(self.new_clicked)
        #self.ui.pushButton_9.clicked.connect(self.open_build_to_run)
        #self.ui.pushButton_10.clicked.connect(self.open_all_builds_folder)
        self.ui.pushButton_8.clicked.connect(self.apps_clicked)
        self.ui.pushButton.clicked.connect(self.import_for_project)
        self.ui.pushButton_2.clicked.connect(self.database_viewer_clicked)
        self.ui.lineEdit.setText(Full_Project_Path)
        self.ui.setWindowTitle(Full_Project_Path)
        pixmap = QPixmap(loading_eyepng)
        self.ui.label_2.setPixmap(pixmap)
        self.ui.label_2.setScaledContents(True)
        self.Update_Projects()

        try:
            from pywinauto.application import Application
            app = Application().connect(title=u'C:\\WINDOWS\\system32\\cmd.exe', class_name='ConsoleWindowClass')
            consolewindowclass = app.ConsoleWindowClass
            consolewindowclass.close()
        except Exception as e:
            print(e)


    def update_controller_build(self):
            try:
                txt1 = ''
                name = ''
                try:
                    with open(lastselectedhubbuildlocationtxt, 'r') as f:
                        os.chdir(f.read())
                except Exception as e:
                    pass


                if 'Windows-7' not in self.get_windows_version():
                    name = QFileDialog.getOpenFileName(parent=self, caption=self.tr("Select a file"),
                                                       filter=self.tr('Image files (*.exe)'), )
                else:
                    name = QFileDialog.getOpenFileName(None, 'Open File', '.', '*', '*',
                                                       QFileDialog.DontUseNativeDialog)
                if name != '':
                    file_name = name[0]
                    if file_name != '':
                        print(file_name)
                        self.ui.label_4.setText(os.path.basename(file_name))
                        with open(lastselectedhubbuildlocationtxt,'w') as f:
                            f.write(os.path.dirname(file_name))
            except Exception as e:
                print(e)




    def open_build_to_run(self):
        try:
            command = 'explorer "$$$"'
            command = command.replace('$$$',Controler_Build_Location)
            print(command)
            os.system(command)
        except Exception as e:
            print(e)


    def open_all_builds_folder(self):
        try:
            command = 'explorer "$$$"'
            command = command.replace('$$$',All_Elan_New_Builds_Folder)
            print(command)
            os.system(command)
        except Exception as e:
            print(e)






    def apps_clicked(self):
        self.width = self.ui.frameGeometry().width()
        self.height = self.ui.frameGeometry().height()
        self.menuBarHeight = self.ui.menuBar.frameGeometry().height()
        self.x = self.ui.geometry().x()
        self.y = self.ui.geometry().y()




        class Apps_Class(QWidget):
            def __init__(self,width,height,x,y,mheight):
                super().__init__()
                self.ui = uic.loadUi(Apps_Ui)
                self.ui.setWindowIcon(QtGui.QIcon(loading_eyepng))
                self.ui.setWindowTitle('Tools')
                self.ui.setMaximumWidth(width)
                self.ui.setMinimumWidth(width)
                self.ui.setMaximumHeight(height / 3)
                self.ui.setMinimumHeight(height / 3)
                self.ui.move((x-2) + width,(y-mheight) - (mheight/2))



                self.ui.show()
        self.App_window = Apps_Class(self.width,self.height,self.x,self.y,self.menuBarHeight)
        try:
            List_of_Buttons = []
            old_path = os.getcwd()
            os.chdir(ElanExeLocation)
            print("########################")
            print(os.getcwd())
            print("########################")
            aList = os.listdir()
            for i in aList:
                if i.endswith('.exe'):
                    path = os.path.abspath(i)
                    Button = QPushButton_Custom_Class(i, path)
                    Button.setStyleSheet('background-color: rgb(171, 171, 171);')
                    Button.clicked.connect(Button.Was_Clicked)
                    List_of_Buttons.append(Button)
                    #self.App_window.ui.gridLayout.addWidget(Button)
            os.chdir(old_path)
            Button = QPushButton('Builds To Run')
            Button.clicked.connect(self.open_build_to_run)
            Button.setMaximumWidth(MaximumWidth)
            Button.setMinimumWidth(MinimumWidth)
            Button.setMaximumHeight(MaximumHeight)
            Button.setMinimumHeight(MinimumHeight)
            Button.setStyleSheet("""background-color: rgb(171, 171, 171);""")
            #self.App_window.ui.gridLayout.addWidget(Button)
            List_of_Buttons.append(Button)



            Button = QPushButton('All Builds Folder')
            Button.clicked.connect(self.open_all_builds_folder)
            Button.setMaximumWidth(MaximumWidth)
            Button.setMinimumWidth(MinimumWidth)
            Button.setMaximumHeight(MaximumHeight)
            Button.setMinimumHeight(MinimumHeight)
            Button.setStyleSheet("""background-color: rgb(171, 171, 171);""")
            #self.App_window.ui.gridLayout.addWidget(Button)
            List_of_Buttons.append(Button)
            positions = [(i, j) for i in range(4) for j in range(2)]
            for position, name in zip(positions, List_of_Buttons):
                if name == '':
                    continue
                self.App_window.ui.gridLayout.addWidget(name,*position)

        except Exception as e:
            print(e)




    def init_Tools(self):
        pass
        '''
        if The_NAME == 'elan':
            try:
                #Label = QLabel('Elan Tools')
                #self.ui.verticalLayout_3.addWidget(Label)
                old_path = os.getcwd()
                os.chdir(ElanExeLocation)
                aList = os.listdir()
                for i in aList:
                    if i.endswith('.exe'):
                        path = os.path.abspath(i)
                        Button = QPushButton_Custom_Class(i,path)
                        Button.setStyleSheet('background-color: rgb(171, 171, 171);')
                        Button.clicked.connect(Button.Was_Clicked)
                        self.ui.verticalLayout_3.addWidget(Button)
                os.chdir(old_path)
            except Exception as e:
                print(e)

        '''




    def Update_Projects(self):
        self.ui.comboBox.clear()
        List = os.listdir(Projects_Location)
        if '.idea' in List:
            List.remove('.idea')
        for i in List:
            i = i.replace('_','')
            #self.ui.comboBox.addItem(os.path.abspath(i))
            self.ui.comboBox.addItem(i)

    def delete_project(self):
        BOOL = Yes_Or_No_Message("Are you sure that you want to delete " + Full_Project_Path + ' ?','Alert')
        if BOOL == True:
            print(Full_Project_Path)
            #os.remove(Full_Project_Path)
        else:
            pass


        #Mbox('Notice', 'Please Wait For Finished Message.', 1)
        #Full_Project_Path


    def Configuration_Menu(self):
        print("Config")
        try:
            import subprocess
            apath = settings_pagepy
            subprocess.Popen(apath, shell=True)
            print(apath)
            ##subprocess.Popen(r"C:\ImageScripter_2\python.exe C:\ImageScripter_2\Lib\site-packages\Script_Writer\settings_page.py", shell=True)

        except Exception as e:
            print(e)


    def get_windows_version(self):
        import platform
        ver = platform.platform()
        return ver




    def Save_Sytem_And_Project(self):
        print('Save System And Project')
        self.Save_Sytem()
        self.Save_Project()
        #from sys import executable
        #from subprocess import Popen, CREATE_NEW_CONSOLE
        #executable = Python_Exe_Location
        #script = smart_export_to_deskoppy
        #Popen([executable, script], creationflags=CREATE_NEW_CONSOLE)
        ###############
        #from reset import Reset_System_Files
        #from reset import Reset_Project_Files

    def Save_Sytem(self):
        try:
            with open(r"C:\root",'r') as f:
                print('Save System')
                from sys import executable
                from subprocess import Popen, CREATE_NEW_CONSOLE
                executable = Python_Exe_Location
                script = Save_Systempy
                Popen([executable, script], creationflags=CREATE_NEW_CONSOLE)
                ##############
                #from reset import Reset_System_Files
        except:
            print('Does not have root')

    def Save_Project(self):
        try:
            with open(r"C:\root",'r') as f:
                print('Save')
                from sys import executable
                from subprocess import Popen, CREATE_NEW_CONSOLE
                executable = Python_Exe_Location
                script = Save_Projectpy
                Popen([executable, script], creationflags=CREATE_NEW_CONSOLE)
                ##############
                #from reset import Reset_Project_Files
        except:
            print('Does not have root')





##########################

    def Reset_Sytem_And_Project(self):
                try:
                    print('Reset System And Project')
                    self.Reset_Sytem()
                    self.Reset_Project()
                    #from sys import executable
                    #from subprocess import Popen, CREATE_NEW_CONSOLE
                    #executable = Python_Exe_Location
                    #script = smart_export_to_deskoppy
                    #Popen([executable, script], creationflags=CREATE_NEW_CONSOLE)
                    ###############
                    #from reset import Reset_System_Files
                    #from reset import Reset_Project_Files
                except Exception as e:
                    print(e)

    def Reset_Sytem(self):
        print('Reset System')
        from sys import executable
        from subprocess import Popen, CREATE_NEW_CONSOLE
        executable = Python_Exe_Location
        script = Reset_Systempy
        Popen([executable, script], creationflags=CREATE_NEW_CONSOLE)
        ##############
        #from reset import Reset_System_Files


    def Reset_Project(self):
        print('Project')
        from sys import executable
        from subprocess import Popen, CREATE_NEW_CONSOLE
        executable = Python_Exe_Location
        script = Reset_Projectpy
        Popen([executable, script], creationflags=CREATE_NEW_CONSOLE)
        ##############
        #from reset import Reset_Project_Files

    def clone_project(self):
        from Hub.clone import Clone_Class
        self.Clone_Window = Clone_Class()

        '''
        try:
            os.chdir(Projects_Location)
            txt1 = ''
            file_name = ''
            if 'Windows-7' not in self.get_windows_version():
                file_name = QFileDialog.getExistingDirectory(self, 'Select directory', directory=Projects_Location)
            else:
                os.chdir(r'C:\\')
                os.chdir(Projects_Location)
                file_name = QFileDialog.getExistingDirectory(self, 'Select directory',
                                                             options=QFileDialog.DontUseNativeDialog, directory=Projects_Location)
            if file_name != '':
                #self.ui.lineEdit_2.setText(file_name)
                short_file_name = os.path.basename(file_name)
                new_location = Projects_Location + '\\' + short_file_name
                if not os.path.isdir(new_location):
                    Mbox('Notice', 'Please Wait For Finished Message.', 1)
                    copyanything(file_name,new_location)
                    Mbox('Notice', 'Finished.', 1)
                else:
                    Mbox('Notice', 'This project already exists, aborting.', 1)

        except Exception as e:
            print(e)
        '''






    def import_for_project(self):
        try:
            os.chdir(Projects_Location)
            txt1 = ''
            file_name = ''
            if 'Windows-7' not in self.get_windows_version():
                file_name = QFileDialog.getExistingDirectory(self, 'Select directory', directory=Projects_Location)
            else:
                os.chdir(r'C:\\')
                os.chdir(Projects_Location)
                file_name = QFileDialog.getExistingDirectory(self, 'Select directory',
                                                             options=QFileDialog.DontUseNativeDialog, directory=Projects_Location)
            if file_name != '':
                #self.ui.lineEdit_2.setText(file_name)
                short_file_name = os.path.basename(file_name)
                new_location = Projects_Location + '\\' + short_file_name
                if not os.path.isdir(new_location):
                    Mbox('Notice', 'Please Wait For Finished Message.', 1)
                    copyanything(file_name,new_location)
                    Mbox('Notice', 'Finished.', 1)
                else:
                    Mbox('Notice', 'This project already exists, aborting.', 1)



        except Exception as e:
            print(e)


    def save_project_clicked(self):
        print('Save')
    def new_clicked(self):
        try:
            self.Wizard_Window = Wizard_Class(self.ui)
            self.Wizard_Window.ui.show()
        except Exception as e:
            print(e)
    def on_combobox_changed(self):
        currentText = str(self.ui.comboBox.currentText())
        self.ui.lineEdit.setText(currentText)

    def script_writer_clicked(self):

        path = Python_Exe_Location_Without_Window + ' ' + ImageScripter_Location + "Lib\site-packages\Script_Writer\script_writer.py"
        self.ui.hide()
        subprocess.call(path, shell=False)
        #os.system(path)
        self.ui.show()
        #proc = subprocess.Popen(path, shell=False)

    def script_runner_was_clicked(self):
        path = Python_Exe_Location_Without_Window + ' ' + ImageScripter_Location + "Lib\site-packages\Script_Runner\script_runner_gui.py"
        self.ui.hide()
        subprocess.call(path, shell=False)
        #os.system(path)
        self.ui.show()
        #proc = subprocess.Popen(path, shell=False)


    def database_viewer_clicked(self):
        path = Python_Exe_Location_Without_Window + ' ' + ImageScripter_Location + "Lib\site-packages\database_viewer\database_viewer.py"
        #proc = subprocess.Popen(path, shell=False)
        self.ui.hide()
        subprocess.call(path, shell=False)
        #os.system(path)
        self.ui.show()

    def script_runner_clicked(self):
        pass
        path = Python_Exe_Location_Without_Window + ' ' + ImageScripter_Location + "Lib\site-packages\Script_Writer\script_writer.py"
        #proc = subprocess.Popen(path, shell=False)
        self.ui.hide()
        subprocess.call(path, shell=False)
        #os.system(path)
        self.ui.show()


if __name__ == '__main__':
    try:
        app = QApplication(sys.argv)
        Hub = Hub_Class()
        sys.exit(app.exec_())
    except Exception as e:
        raise
        e = str(e)
        import ctypes
        ctypes.windll.user32.MessageBoxW(0, e, 'Error', 0)
