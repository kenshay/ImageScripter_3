from paths import *
import os
import shutil, errno
from dirsync import sync


try:
    os.remove(IMAGESCRIPTERPATH + r"\System\ImageScripter\.git\index.lock")
    os.remove(IMAGESCRIPTERPATH + r"\Projects\_elan_\elan")
except:
    pass

with open(Git_Log_Txt,'w') as f:
    f.write('')

print('########################################')
print("\n\n\nSave Project Files\n\n\n")
print('########################################')

##Elan_Folder2 = r"C:\ImageScripter_2\Lib\site-packages\elan"
##Elan_Folder_Settings = r"C:\Settings\elan"



#source = PROJECT
#destination = Elan_Folder_Settings


#def copyanything(src, dst):
#    try:
#        shutil.copytree(src, dst)
#    except OSError as exc: # python >2.5
#        if exc.errno == errno.ENOTDIR:
#            shutil.copy(src, dst)
#        else: raise
#print("Starting Reset")
##gitProject = r"C:\ImageScripter_2"

##git = r"C:\ImageScripter_2\Sync\cmd\git.exe"
print('Saving -> ',Full_Project_Path)
os.chdir(Full_Project_Path)

print(git)


os.system(git + ' add --all >> {}'.format(Git_Log_Txt))
os.system(git + " commit -a -m 'asd'  >> {}".format(Git_Log_Txt))
os.system(git + ' pull  >> {}'.format(Git_Log_Txt))
os.system(git + ' push  >> {}'.format(Git_Log_Txt))
os.system(git + ' status  >> {}'.format(Git_Log_Txt))




#sync(source,destination, 'sync', purge = True)
print(Full_Project_Path)
#input("Finished Save, you can now close this window")

with open(Git_Log_Txt) as f:
    text = str(f.read())

Tags = ["Automatic merge failed","unfinished merge","diverged"]


for tag in Tags:
    if tag in text:
        raise ValueError(text)


#try:
#    shutil.rmtree(old_elan)
#except Exception as e:
#    print(e)
#print('Please Wait...')
#copyanything(elan_folder, old_elan)
#input("Finished Reset")

