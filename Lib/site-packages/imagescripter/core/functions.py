import os, shutil
import pyautogui
import win32gui
import win32con
from time import sleep


def get_data_from_file(x):
    with open(x, 'r') as f:
        data = f.readline()
    ###For Bool
    if data == "True":
        return True
    elif data == "False":
        return False
    else:
        return data

def Press(stringToPress):
    print("Pressing -> ", stringToPress)
    pyautogui.press(stringToPress)
    print("Pressed -> ", stringToPress)




def getListOfAllApplications():
    print('Getting a list of all opened applications')
    list = []
    def enumHandler(hwnd, lParam):
        if win32gui.IsWindowVisible(hwnd):
            list.append(hwnd)
            #list.append(win32gui.GetWindowText(hwnd))
    win32gui.EnumWindows(enumHandler, None)
    list = [x for x in list if x]
    return list


def Start_Image_Show():
    pass


def Close_Image_Show():
    pass


def Start_Image_Show2():
    try:
        #from elan import *
        import subprocess
        import os
        python = r"C:\ImageScripter_2\python.exe "
        script = r"C:\ImageScripter_2\Lib\site-packages\imagescripter\core\Image_Show.py"
        commmand = python + script
        subprocess.Popen(commmand, shell=True)
    except Exception as e:
        print(e)

def Close_Image_Show2():
    try:
        from elan import ShowImage
        ShowImage.Close()
    except Exception as e:
        print(e)

















def Close_Viewer():
    from imagescripter.core.variable_file_getter import Variable_File_Getter
    from elan import Viewer
    from elan import ELANViewer
    for i in range(2):
        print('Trying to close the Viewer')
        try:
            try:
                print('Trying Close with x')
                Viewer.CloseWithX()
            except Exception as e:
                print(e)

            try:
                print('Trying Close')
                Viewer.Close()
            except Exception as e:
                print(e)

            try:
                print('Trying Close_And_Clean')
                Viewer.CloseAndClean()
            except Exception as e:
                print(e)
            try:
                ELANViewer.Move(0,0)
                ELANViewer.PushButton.Click("OK")
                try:
                    ELANViewer.Close()
                except Exception as e:
                    print(e)
            except Exception as e:
                print(e)

        except Exception as e:
            print(e)
            print('Trying to close viewer -> ',i)








def closeAllApplicationsNotInList(Last_List):
    from elan import Viewer
    from elan import Close_Image_Show
    print('Closing All Applications Not In List')
    #try:
    #    Close_Image_Show()
    #except:
    #    pass


    for i in range(10):
        sleep(.10)
        New_List = getListOfAllApplications()
        for handle in New_List:
            if 'Show Image' not in win32gui.GetWindowText(handle):
                if handle not in Last_List:
                    try:
                        win32gui.PostMessage(handle, win32con.WM_CLOSE, 0, 0)
                    except Exception as e:
                        print(e)
                        sleep(1)
                        try:
                            win32gui.PostMessage(handle, win32con.WM_CLOSE, 0, 0)
                        except Exception as e:
                            print(e)
    Close_Viewer()

    print('Finished Closing All Applications Not In List')









def rename_all_files_in_folder():
    import os
    #os.chdir(r"C:\Users\Automation3\Desktop\Project_Elan\Applications_And_Devices\Configurator")
    # os.rename('guru99.txt','career.guru99.txt')
    for file in os.listdir():
        if file.endswith('.png'):
            old_name = file
            new_name = old_name.split('_')[1]
            print(new_name)
            os.rename(file, new_name)

def Clear_Directory_Contents(Directory_Path):
    print("Clearing Directory Contents -> ", Directory_Path)
    try:
        for the_file in os.listdir(Directory_Path):
            file_path = os.path.join(Directory_Path, the_file)
            try:
                if os.path.isfile(file_path):
                    os.unlink(file_path)
                    print('Removed -> ', file_path)
            except Exception as e:
                print(e)
    except FileNotFoundError:
        os.makedirs(Directory_Path)