from imagescripter.core.device import Device_Class
import os
from paths import *


##adb_location = "C:\Elan_Tools\ImageScripter\ProgramData\Android\ADB\platform-tools\\"
##screenshotfile = r'C:\ImageScripter_2\TEMP\Android_Screenshot.png'


class Android_Class(Device_Class):
    def _click_(self,x,y):
        curdir = os.getcwd()
        os.chdir(adb_location)
        x = str(x)
        y = str(y)
        string = 'adb shell input tap #X #Y'
        string = string.replace('#X',x)
        string = string.replace('#Y',y)
        os.system(string)
        os.chdir(curdir)
    def _get_image_of_screen_(self,attempts = 100):
        curdir = os.getcwd()
        os.chdir(adb_location)
        command1 = r'adb shell screencap /sdcard/screen.png'
        command2 = r'adb pull /sdcard/screen.png #$%'
        command2 = command2.replace('#$%',screenshotfile)
        os.system(command1)
        os.system(command2)
        os.chdir(curdir)
        return screenshotfile
'''
 adb shell
shell@ $ screencap /sdcard/screen.png
shell@ $ exit
$ adb pull /sdcard/screen.png
'''


if __name__ == "__main__":
    while True:
        Interface = Android_Class()
        actual_img_path = Interface._get_image_of_screen_()

        ##aonepng = r"C:\ImageScripter_3\TEMP\Android_Pics\1.png"

        target_img_path = aonepng
        x,y = Interface._get_location_of_image_in_image(target_img_path,actual_img_path,threshold=.96)
        #x = 164
        #y = 499
        print(x,y)
        Interface._click_(x,y)

        actual_img_path = Interface._get_image_of_screen_()

        ##atwopng = r"C:\ImageScripter_3\TEMP\Android_Pics\2.png"


        target_img_path = atwopng
        x, y = Interface._get_location_of_image_in_image(target_img_path, actual_img_path, threshold=.96)
        # x = 164
        # y = 499
        print(x, y)
        Interface._click_(x, y)
