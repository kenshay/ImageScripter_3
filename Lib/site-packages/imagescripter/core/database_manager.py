import sqlite3
import shutil
import os
import time
from imagescripter.core.variable_file_getter import Variable_File_Getter

fresh_data_base = Variable_File_Getter.getVariableFromFile('fresh_database_location')



class Database_Manager_Class():
    def __init__(self,database_location):
        self.database_location_file = database_location
        self.database_folder_location = os.path.dirname(self.database_location_file)
        self.database_name = os.path.basename(self.database_location_file)
        self.database_name_without_db = self.database_name.strip('.db')
        if os.path.isfile(self.database_location_file) == False:
            self.Create_New_Database()
        else:
            print('Fount Database -> ',self.database_location_file)

    def enter_results_into_database(self,Index_Time,Index_Time_String,Script_Start_Time, Steps, Date, Script_End_Time, Script_Name, Pass, Fail, Skip,Controller_Name,Station_Name, Controller_Build, Error, target_img, templet_img, Error_ID,Fail_Video,Pass_Video,Client):
        print('Entering Results Into Database -> ',self.database_location_file)
        conn = sqlite3.connect(self.database_location_file)
        c = conn.cursor()
        c.execute('''INSERT INTO Reports(Index_Time,Index_Time_String,Script_Start_Time,Steps, Date,Script_End_Time, Script_Name, Pass, Fail, Skip, Controller_Name, Station_Name, Controller_Build,Error,target_img,templet_img,Error_ID,Fail_Video,Pass_Video,Client)
                                  VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)''',
                  (Index_Time,Index_Time_String,Script_Start_Time, Steps, Date, Script_End_Time, Script_Name, Pass, Fail, Skip,Controller_Name,Station_Name, Controller_Build, Error, target_img, templet_img, Error_ID, Fail_Video, Pass_Video, Client))
        conn.commit()
        conn.close()
        print('Entered Results Into Database -> ', self.database_location_file)

    def enter_test_results_into_database(self):
        print('Entering Results Into Database -> ',self.database_location_file)
        Index_Time = time.time()
        Script_Start_Time = 'Test'
        Steps = 'Test'
        Date = 'Test'
        Script_End_Time = 'Test'
        Script_Name = 'Test'
        Pass = 'Test'
        Fail = 'Test'
        Skip = 'Test'
        Controller_Name = 'Test'
        Station_Name = 'Test'
        Controller_Build = 'Test'
        Error = 'Test'
        target_img = 'Test'
        templet_img = 'Test'
        Index_Time_String = 'Test'

        Error_ID = 'Test'
        conn = sqlite3.connect(self.database_location_file)
        c = conn.cursor()
        c.execute('''INSERT INTO Reports(Index_Time,Index_Time_String,Script_Start_Time,Steps, Date,Script_End_Time, Script_Name, Pass, Fail, Skip, Controller_Name, Station_Name, Controller_Build,Error,target_img,templet_img,Error_ID)
                                  VALUES(?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?,?)''',
                  (Index_Time,Index_Time_String,Script_Start_Time, Steps, Date, Script_End_Time, Script_Name, Pass, Fail, Skip,Controller_Name,Station_Name, Controller_Build, Error, target_img, templet_img, Error_ID))
        conn.commit()
        conn.close()

    def Create_New_Database(self):
        print("Creating New Database -> ",self.database_location_file)
        lastcmd = os.getcwd()
        Folder = self.database_folder_location
        os.chdir(Folder)
        shutil.copy(fresh_data_base,self.database_location_file)
        os.chdir(lastcmd)

if __name__ == "__main__":
    from imagescripter.core.variable_file_getter import Variable_File_Getter

    print(Variable_File_Getter.getVariableFromFile('Database_Location'))

    database_location = Variable_File_Getter.getVariableFromFile('Database_Location')
    Database_Manager = Database_Manager_Class(database_location)
    Database_Manager.enter_test_results_into_database()