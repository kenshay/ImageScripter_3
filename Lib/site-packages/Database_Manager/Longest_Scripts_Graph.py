from paths import Dictionary_Database_Location,All_Scripts_Folder_Location
from Database_Manager.Dictionary_Database_Manager import Dictionary_Database_Manager_Class
import os
import ntpath
import matplotlib.pyplot as plt


def convert(seconds):
    seconds = seconds % (24 * 3600)
    hour = seconds // 3600
    seconds %= 3600
    minutes = seconds // 60
    seconds %= 60
    return "%d:%02d:%02d" % (hour, minutes, seconds)


Dictionary_Database_Manager = Dictionary_Database_Manager_Class(Dictionary_Database_Location)



List_Of_Dictionary_Entries = Dictionary_Database_Manager.get_entries('pass:True')
os.chdir(All_Scripts_Folder_Location)
Accepted = ['Frank','Ip_Amp','Quick_Tests','Smoke_Station']
for folder in os.listdir(All_Scripts_Folder_Location):
    if folder in Accepted:
        Total_Time_In_Seconds = 0
        List_Of_Scripts = []
        x = []
        y = []
        ##############################
        files = []
        for r, d, f in os.walk(folder):
            for file in f:
                if file.endswith('.py'):
                    files.append(ntpath.basename(file))
        for f in files:
            #print(f)
            f = f.strip('.py')
            List_Of_Scripts.append(f)
        ############################
        for script_name in List_Of_Scripts:
            #print(script_name)
            for entry in List_Of_Dictionary_Entries:
                Parsed_Script_Name = entry['script_name'].split(":")[1]
                if Parsed_Script_Name == script_name:
                    script_duration = entry['script_duration']
                    script_duration = script_duration.split(':')
                    script_duration = script_duration[1]
                    script_duration = float(script_duration)
                    Total_Time_In_Seconds += script_duration
                    print(script_duration,script_name)
                    y.append(script_duration)
                    x.append(script_name)
                    break

        plt.bar(x,y, align='center', alpha=0.5)
        #plt.plot(x, y)
        plt.xlabel('Scripts')
        plt.ylabel('Seconds')
        import matplotlib as mpl
        mpl.rcParams['toolbar'] = 'None'
        plt.title(folder + 'Total Hours = '+ str(convert(Total_Time_In_Seconds)))
        plt.xticks(rotation=90)
        plt.show()









