

from email.mime.multipart import MIMEMultipart
from email.mime.text import MIMEText
from email.mime.image import MIMEImage
import os
import smtplib
from paths import Graph_Folder_Location



strFrom = 'ElanTesterTools@gmail.com'



recipients = ["kennyshay123@gmail.com",
          "Ben.Bickell@nortekcontrol.com",
          "elantestertools@gmail.com",
          "ken.shay@nortekcontrol.com"]


recipients = ["kennyshay123@gmail.com",
          "elantestertools@gmail.com",
          "ken.shay@nortekcontrol.com"]





msgRoot = MIMEMultipart('related')
msgRoot['Subject'] = 'Daily Graph Automated Message Test'
msgRoot['From'] = strFrom
msgRoot['To'] = strFrom
msgRoot.preamble = 'This is a multi-part message in MIME format.'

msgAlternative = MIMEMultipart('alternative')
msgRoot.attach(msgAlternative)


os.chdir(Graph_Folder_Location)
List_Of_Graphs_Without_Png = []
for graph_image in os.listdir(Graph_Folder_Location):
    if graph_image.endswith('.png'):
        graph_image_without_png = graph_image.strip('.png')
        List_Of_Graphs_Without_Png.append(graph_image_without_png)
        fp = open(graph_image, 'rb')
        msgImage = MIMEImage(fp.read())
        fp.close()
        msgImage.add_header('Content-ID', '<' + graph_image_without_png + '>')
        msgRoot.attach(msgImage)
Text = ''
for graph in List_Of_Graphs_Without_Png:
    peice = '<img src="cid:$$$"><br>'
    peice = peice.replace('$$$', graph)
    Text = Text + peice

msgText = MIMEText(Text, 'html')
msgAlternative.attach(msgText)
smtp = smtplib.SMTP()
gmail_user = "ElanTesterTools@gmail.com"
gmail_password = "M8wh11YhL"
gmail_user = "kennyshay123@gmail.com"
gmail_password = "Mermaid123"
server = smtplib.SMTP_SSL('smtp.gmail.com', 465)
server.ehlo()
server.login(gmail_user, gmail_password)
server.sendmail(strFrom,recipients,msgRoot.as_string())
server.close()

