import matplotlib.pyplot as plt; plt.rcdefaults()
import numpy as np
import matplotlib.pyplot as plt
import matplotlib
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib import pyplot, transforms
from paths import Dictionary_Database_Location,All_Scripts_Folder_Location,Graph_Folder_Location
from Database_Manager.Dictionary_Database_Manager import Dictionary_Database_Manager_Class
import os
from matplotlib.ticker import MaxNLocator

Dictionary_Database_Manager = Dictionary_Database_Manager_Class(Dictionary_Database_Location)






sns.set()
IGNORE_LIST = ['Kens_Desk']
Stations_List = Dictionary_Database_Manager.get_all_station_names()
for Station_Name in Stations_List:
    if Station_Name not in IGNORE_LIST:
        print('Station Name is ',Station_Name)
        scripts = Dictionary_Database_Manager.get_all_scripts_from_station(Station_Name)
        PassesList = []
        FailsList = []
        PassesFailsListOfLists = []
        for script in scripts:
            Pass_Int,Fail_Int = Dictionary_Database_Manager.get_total_scripts_passes_and_fails(Station_Name,script)
            PassesFailsList = str(Dictionary_Database_Manager.get_scripts_passes_and_fails_ordered_list(Station_Name,script))
            print(script,' ',Pass_Int,' ',Fail_Int)
            amount_of_fails_this_script_has = Fail_Int
            FailsList.append(amount_of_fails_this_script_has)
            amount_of_passes_this_script_has = Pass_Int
            PassesList.append(amount_of_passes_this_script_has + amount_of_fails_this_script_has)
            PassesFailsListOfLists.append(PassesFailsList)
        Fails = np.array(FailsList)
        Passes = np.array(PassesList)

        y_pos = np.arange(len(scripts))
        fig = plt.figure(figsize=(8.5 * 1.5,22 * 1.5),dpi=300)


        ax = fig.add_subplot(111)


        ax.barh(y_pos, Passes,color='#37c472',align='center',label='Pass')
        ax.barh(y_pos, Fails, color='#ad4949', align='center', label='Fail')

        ax.xaxis.set_major_locator(MaxNLocator(integer=True))


        ax.set_yticks(y_pos)
        #ax.grid(color='red', alpha=5, linestyle='solid')

        ax.xaxis.tick_top()
        ax.xaxis.set_ticks_position('both')
        ax.set_yticklabels(scripts)


        x2 = ax.twinx()
        x2.set_xticklabels(PassesFailsListOfLists)

        #ax2.set_ylabel('Y2 data', color='b')
        ######################################################
        plt.xlabel("Amount",labelpad=30)
        plt.ylabel("Scripts")
        handles, labels = ax.get_legend_handles_labels()
        ax.legend(handles, labels)
        plt.legend(loc='best')
        plt.title(Station_Name + '             ' + Dictionary_Database_Manager.Active_Build_without_EXE,pad=30)
        plt.gcf().subplots_adjust(left=0.40,top=.90,bottom=.06,right=.98)
        os.chdir(Graph_Folder_Location)
        plt.savefig(Station_Name + '.png')
