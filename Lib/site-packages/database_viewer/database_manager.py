import sqlite3
import os







class DataBase_Manager_Class():
    def __init__(self,database_folder):
        self.DatabasseFoler = database_folder

    def get_names_of_all_databases_list(self):
        names_of_all_databases = os.listdir(self.DatabasseFoler)
        return names_of_all_databases


    def get_data_from_databases(self,Target = '*',Index_Time = "%",Date = "%",Script_Start_Time = "%",Script_End_Time = "%",Station_Name = "%",Controller_Name = "%",Script_Name = "%",Controller_Build = "%",Pass = "%",Fail = "%",Skip = "%",Error = "%",Target_Img = "%",Templet_Img = "%",Steps = "%",Error_ID = "%",Notes = "%",Ignore = "%",Fail_Video = "%",Pass_Video = "%",Client = "%"):
        os.chdir(self.DatabasseFoler)
        all_databases_list = self.get_names_of_all_databases_list()
        Data_List = []

        for database in all_databases_list:
            print(database)
            sqlite_file = database
            conn = sqlite3.connect(sqlite_file)
            c = conn.cursor()
            # + " AND Pass like '" + Pass + "'"
            #command = "SELECT * FROM Reports WHERE Index_Time like '" + Index_Time + "' AND Date like '" + Date + "'" + " AND Script_Start_Time like '" + Script_Start_Time + "'" + " AND Script_End_Time like '" + Script_End_Time + "'" + " AND Station_Name like '" + Station_Name + "'" + " AND Controller_Name like '" + Controller_Name + "'" + " AND Script_Name like '" + Script_Name + "'" + " AND Controller_Build like '" + Controller_Build + "'" + " AND Pass like '" + Pass + "'" + " AND Fail like '" + Fail + "'" + " AND Skip like '" + Skip + "'" + " AND Error like '" + Error + "'" + " AND Target_Img like '" + Target_Img + "'" + " AND Templet_Img like '" + Templet_Img + "'" + " AND Steps like '" + Steps + "'" + " AND Error_ID like '" + Error_ID + "'" + " AND Pass_Video like '" + Pass_Video + "'" + " AND Client like '" + Client + "'" + " AND Fail_Video like '" + Fail_Video + "'"
            command = "SELECT " + Target + ' ' + "FROM Reports WHERE Index_Time like '" + Index_Time + "' AND Date like '" + Date + "'" + " AND Script_Start_Time like '" + Script_Start_Time + "'" + " AND Script_End_Time like '" + Script_End_Time + "'" + " AND Station_Name like '" + Station_Name + "'" + " AND Controller_Name like '" + Controller_Name + "'" + " AND Script_Name like '" + Script_Name + "'" + " AND Controller_Build like '" + Controller_Build + "'" + " AND Pass like '" + Pass + "'" + " AND Fail like '" + Fail + "'" + " AND Skip like '" + Skip + "'" + " AND Error like '" + Error + "'" + " AND Target_Img like '" + Target_Img + "'" + " AND Templet_Img like '" + Templet_Img + "'" + " AND Steps like '" + Steps + "'" + " AND Error_ID like '" + Error_ID + "'" + " AND Pass_Video like '" + Pass_Video + "'" + " AND Client like '" + Client + "'" + " AND Fail_Video like '" + Fail_Video + "'"
            try:
                c.execute(command)
            except sqlite3.OperationalError:
                #command = "SELECT * FROM Reports WHERE Index_Time like '" + Index_Time + "' AND Date like '" + Date + "'" + " AND Script_Start_Time like '" + Script_Start_Time + "'" + " AND Script_End_Time like '" + Script_End_Time + "'" + " AND Station_Name like '" + Station_Name + "'" + " AND Controller_Name like '" + Controller_Name + "'" + " AND Script_Name like '" + Script_Name + "'" + " AND Controller_Build like '" + Controller_Build + "'" + " AND Pass like '" + Pass + "'" + " AND Fail like '" + Fail + "'" + " AND Skip like '" + Skip + "'" + " AND Error like '" + Error + "'" + " AND Target_Img like '" + Target_Img + "'" + " AND Templet_Img like '" + Templet_Img + "'" + " AND Steps like '" + Steps + "'" + " AND Error_ID like '" + Error_ID + "'"
                command = "SELECT " + Target + ' ' + "FROM Reports WHERE Index_Time like '" + Index_Time + "' AND Date like '" + Date + "'" + " AND Script_Start_Time like '" + Script_Start_Time + "'" + " AND Script_End_Time like '" + Script_End_Time + "'" + " AND Station_Name like '" + Station_Name + "'" + " AND Controller_Name like '" + Controller_Name + "'" + " AND Script_Name like '" + Script_Name + "'" + " AND Controller_Build like '" + Controller_Build + "'" + " AND Pass like '" + Pass + "'" + " AND Fail like '" + Fail + "'" + " AND Skip like '" + Skip + "'" + " AND Error like '" + Error + "'" + " AND Target_Img like '" + Target_Img + "'" + " AND Templet_Img like '" + Templet_Img + "'" + " AND Steps like '" + Steps + "'" + " AND Error_ID like '" + Error_ID + "'"
                c.execute(command)
            rows = c.fetchall()
            for row in rows:
                Data_List.append(row)
        return Data_List

Database_Folder = r"C:\Users\Automation3\Desktop\Database"
DataBase_Manager = DataBase_Manager_Class(Database_Folder)

if __name__ == '__main__':
    Data = DataBase_Manager.get_data_from_databases(Fail='True')
    for i in Data:
        print(i)
        #print(i[5])
