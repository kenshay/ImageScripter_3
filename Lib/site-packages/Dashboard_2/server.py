import socket
import sys
from _thread import start_new_thread
from paths import Dashboard_Server_IP,Dashboard_Server_PORT
import os
import traceback


def client_thread(Info):
    try:
        print('Creating Thread')
        conn, addr = Info
        #conn.send(b"Welcome to the Server. Type messages and press enter to send.\n")
        IP = str(addr[0])
        PORT = str(addr[1])
        print('Thread Created With ',IP,' : ',PORT)
        while True:
            data = conn.recv(1024)
            data = str(data.decode())
            print(data)
    except Exception as e:
        traceback.print_exc()
        conn.close()


while True:
    print('Starting Server')
    HOST = Dashboard_Server_IP
    socket_connection = socket.socket(socket.AF_INET, socket.SOCK_STREAM)
    socket_connection.bind((HOST, Dashboard_Server_PORT))
    print('Created Socket ',HOST,' : ',Dashboard_Server_PORT)
    socket_connection.listen(10)
    while True:
        conn, addr = socket_connection.accept()
        Info = [conn,addr]
        start_new_thread(client_thread, (Info,))
    socket_connection.close()