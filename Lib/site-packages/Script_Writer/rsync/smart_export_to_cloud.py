



try:
    import os
    import platform
    import ctypes
    import shutil, errno
    import stat
    import time
    import sys
    from distutils.dir_util import copy_tree
    def copyanything(src, dst):
        try:
            shutil.copytree(src, dst)
        except OSError as exc:  # python >2.5
            if exc.errno == errno.ENOTDIR:
                shutil.copy(src, dst)
            else:
                raise
    def errorRemoveReadonly(func, path, exc):
        excvalue = exc[1]
        if func in (os.rmdir, os.remove) and excvalue.errno == errno.EACCES:
            # change the file to be readable,writable,executable: 0777
            os.chmod(path, stat.S_IRWXU | stat.S_IRWXG | stat.S_IRWXO)
            # retry
            func(path)
        else:
            shutil.rmtree(path)
            print('raiseenter code here')





    Index_File_Path = r"C:\Settings\Export_Index"
    try:
        with open(Index_File_Path, 'r') as f:
            Index_Number = int(f.read())
    except:
        with open(Index_File_Path, 'w') as f:
            Index_Number = 0
            f.write(str(Index_Number))




    print("Starting")
    Path = r"C:\ImageScripter_2\Lib\site-packages\Script_Writer\rsync"
    print("Change Path To -> ",Path)
    os.chdir(Path)
    Desktop = os.path.join(os.environ["HOMEPATH"], "Desktop")
    timeString = str(time.time())
    Index_String = str(Index_Number)
    with open(Index_File_Path, 'w') as f:
        Index_Number += 1
        f.write(str(Index_Number))


    End_folder = Index_String + '_Smart_Export_' + platform.node() + '_' + timeString + '/'

    NAS_DRIVE = r"//172.16.43.21/nas/Cloud_Drive/Writer_Backups/" + End_folder
    print(NAS_DRIVE)

    #Desktop = Desktop.replace('\\','/')
    #Desktop_File = '/cygdrive/c' + Desktop + '/' + End_folder
    command = "rsync  -rvcm --no-p --chmod=ugo=rwX --no-g --no-o --compare-dest=/cygdrive/c/Settings/elan/ /cygdrive/c/ImageScripter_2/Lib/site-packages/elan/ " + NAS_DRIVE
    print(command)
    os.system(command)
    #os.chdir(os.path.join(os.environ["HOMEPATH"], "Desktop"))
    #End_folder = End_folder.replace('/','')
    #NAS_DRIVE = r"\\172.16.43.21\nas\Cloud_Drive\Writer_Backups" + '\\' + End_folder
    #print('################')
    #print(NAS_DRIVE)
    #copyanything(End_folder,NAS_DRIVE)
    #shutil.rmtree(End_folder, ignore_errors=False, onerror=errorRemoveReadonly)
    input("Finished Exporting -> " + NAS_DRIVE)

except Exception as e:
    print(e)
    raise
    input('Error')