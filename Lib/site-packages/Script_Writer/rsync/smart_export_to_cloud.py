try:
    from paths import *
    import os
    import platform
    import ctypes
    import shutil, errno
    import stat
    import time
    import sys
    from distutils.dir_util import copy_tree
    ##Index_File_Path = r"C:\Settings\Export_Index"
    try:
        with open(Export_Index22, 'r') as f:
            Index_Number = int(f.read())
    except:
        with open(Export_Index22, 'w') as f:
            Index_Number = 0
            f.write(str(Index_Number))

    def copyanything(src, dst):
        try:
            shutil.copytree(src, dst)
        except OSError as exc:  # python >2.5
            if exc.errno == errno.ENOTDIR:
                shutil.copy(src, dst)
            else:
                raise






    print("Starting")

   ## Rysyc2 = r"C:\ImageScripter_2\Lib\site-packages\Script_Writer\rsync"

    Path = rsync_path
    print("Change Path To -> ",Path)
    os.chdir(Path)
    Desktop = os.path.join(os.environ["HOMEPATH"], "Desktop")
    timeString = str(time.time())
    Index_String = str(Index_Number)
    with open(Export_Index22, 'w') as f:
        Index_Number += 1
        f.write(str(Index_Number))
    End_folder = Index_String + '_Smart_Export_' + platform.node() + '_' + timeString + '/'
    Desktop = Desktop.replace('\\','/')
    Desktop_File = '/cygdrive/C' + Desktop + '/' + End_folder

    ##rsycconnand22 = "rsync  -rvcm --chmod=ug=rwX,o=rxX --compare-dest=/cygdrive/c/Settings/elan/ /cygdrive/c/ImageScripter_2/Lib/site-packages/elan/ "
    command = rsycconnand22 + Desktop_File
    print('##########')
    print(command)
    print("rsync  -rvcm --chmod=ug=rwX,o=rxX --compare-dest=/cygdrive/c/Ellumination/System/Data/elan/ /cygdrive/c/Ellumination/Projects/_elan_/elan/ /cygdrive/c/Users/Administrator/Desktop/test/")


    os.system(command)
    os.chdir(Desktop)
    End_folder = End_folder.replace('/','')
    os.chdir(End_folder)
    os.system('icacls * /T /Q /C /RESET')
    ##writerbackups1234 = r"\\172.16.43.21\nas\Cloud_Drive\Writer_Backups"

    NAS = NAS_DRIVE + '\\' + End_folder
    print(NAS)
    print('Copying to NAS')
    os.chdir(Desktop)
    copyanything(End_folder,NAS)
    import os

    print('################ Files Saved #######################')
    files = []
    # r=root, d=directories, f = files
    for r, d, f in os.walk(End_folder):
        for file in f:
                files.append(os.path.join(r, file))
    if len(files) != 0:
        print('Total Amount -> ', len(files))
        for f in files:
            print(f)
    else:
        print('No New Files Detected')
    print('####################################################')
    #os.chdir(Desktop)
    #os.remove(End_folder)
    input("Finished Exporting -> " + Desktop + '\\' + Desktop_File)

except Exception as e:
    print(e)
    input('Error')
