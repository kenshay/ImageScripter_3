try:
    import os
    import platform
    import ctypes
    import shutil, errno
    import stat
    import time
    import sys
    from distutils.dir_util import copy_tree

    Index_File_Path = r"C:\Settings\Export_Index"
    try:
        with open(Index_File_Path, 'r') as f:
            Index_Number = int(f.read())
    except:
        with open(Index_File_Path, 'w') as f:
            Index_Number = 0
            f.write(str(Index_Number))








    print("Starting")
    Path = r"C:\ImageScripter_2\Lib\site-packages\Script_Writer\rsync"
    print("Change Path To -> ",Path)
    os.chdir(Path)
    Desktop = os.path.join(os.environ["HOMEPATH"], "Desktop")
    timeString = str(time.time())
    Index_String = str(Index_Number)
    with open(Index_File_Path, 'w') as f:
        Index_Number += 1
        f.write(str(Index_Number))
    End_folder = Index_String + '_Smart_Export_' + platform.node() + '_' + timeString + '/'
    Desktop = Desktop.replace('\\','/')
    Desktop_File = '/cygdrive/c' + Desktop + '/' + End_folder
    #command = "rsync  -rvcm --no-p --chmod=ugo=rwX --no-g --no-o --compare-dest=/cygdrive/c/Settings/elan/ /cygdrive/c/ImageScripter_2/Lib/site-packages/elan/ " + Desktop_File
    command = "rsync  -rvcm --chmod=ug=rwX,o=rxX --compare-dest=/cygdrive/c/Settings/elan/ /cygdrive/c/ImageScripter_2/Lib/site-packages/elan/ " + Desktop_File
    #command = "rsync  -rvcm --chmod=ugo=rwX --compare-dest=/cygdrive/c/Settings/elan/ /cygdrive/c/ImageScripter_2/Lib/site-packages/elan/ " + Desktop_File
    #command = "rsync  -rvcm --compare-dest=/cygdrive/c/Settings/elan/ /cygdrive/c/ImageScripter_2/Lib/site-packages/elan/ " + Desktop_File
    os.system(command)
    os.chdir(Desktop)
    End_folder = End_folder.replace('/','')
    print('################ Files Saved #######################')
    files = []
    # r=root, d=directories, f = files
    for r, d, f in os.walk(End_folder):
        for file in f:
                files.append(os.path.join(r, file))
    if len(files) != 0:
        print('Total Amount -> ', len(files))
        for f in files:
            print(f)
    else:
        print('No New Files Detected')
    print('####################################################')




    os.chdir(End_folder)
    os.system('icacls * /T /Q /C /RESET')
    #os.chdir(Desktop)
    #os.remove(End_folder)
    input("Finished Exporting -> " + Desktop + '\\' + Desktop_File)

except Exception as e:
    print(e)
    input('Error')
