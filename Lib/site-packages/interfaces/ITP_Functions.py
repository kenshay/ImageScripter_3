
#from paths import *
from scp import SCPClient
from paramiko import SSHClient
import paramiko
import os
import time
import traceback
from fabric import Connection
from pywinauto.application import Application
import pywinauto



def Sleep(sec):
    for i in range(sec):
        print(i,' ', sec)
        time.sleep(1)


def Enable_Root_SSH(server_ip,port,root_username,root_password,admin_username,admin_password):
      app = Application(backend="uia").start('C:\Eluminate\System\Data\elan\exe\putty.exe')
      window = app.window(best_match='PuTTY Configuration')
      window.Edit.set_text(server_ip)
      window.RadioButton4.click()
      window.Edit2.set_text(str(port))
      window.Open.click()
      match_string = '$$ - PuTTY'
      match_string = match_string.replace('$$',server_ip)
      cmd = app.window(best_match=match_string)
      cmd.type_keys(admin_username + '{PAUSE 1}{ENTER}{PAUSE 1}')
      cmd.type_keys(admin_password + '{PAUSE 1}{ENTER}{PAUSE 1}')
      match_string = u'$$@debian: ~'
      match_string = match_string.replace('$$',admin_username)
      cmd = app.window(title=match_string)
      cmd.type_keys('su ' + root_username + '{PAUSE 1}{ENTER}{PAUSE 1}', with_spaces=True)
      cmd.type_keys(root_password + '{PAUSE 1}{ENTER}{PAUSE 1}', with_spaces=True)
      cmd.type_keys('nano /etc/ssh/sshd_config{PAUSE 1}{ENTER}{PAUSE 1}', with_spaces=True)
      for i in range(31):
          cmd.type_keys('{DOWN}', with_spaces=True)
      cmd.type_keys('{RIGHT}', with_spaces=True)
      cmd.type_keys('{BACKSPACE}{PAUSE 1}', with_spaces=True)
      cmd.type_keys('^o{PAUSE 1}', with_spaces=True)
      cmd.type_keys('{ENTER}{PAUSE 1}', with_spaces=True)
      cmd.type_keys('^x{PAUSE 1}', with_spaces=True)
      cmd.type_keys('/etc/init.d/ssh restart{ENTER}{PAUSE 1}', with_spaces=True)
      cmd.close()
      Sleep(1)
      w_handle = pywinauto.findwindows.find_windows(title=u'PuTTY Exit Confirmation', class_name='#32770')[0]
      window = app.window_(handle=w_handle)
      Sleep(1)
      ctrl = window['OK']
      ctrl.click()


#../opt/ELAN/elan_factory_reset.sh -f


if __name__ == "__main__":
      server_ip = '192.168.0.56'
      port = 2199
      root_username = 'root'
      root_password = 'N0rt3k$C'
      admin_username = 'admin'
      admin_password = 'N5C_itp!'
      Enable_Root_SSH(server_ip,port,root_username,root_password,admin_username,admin_password)


